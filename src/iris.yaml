kind: job
metadata:
  name: xgb
  tag: ''
  hash: 5267dc8ff8057ac358612edb1dd4a4f9272c54e5
  project: ''
spec:
  command: ''
  args: []
  env: []
  default_handler: ''
  entry_points:
    iris_generator:
      name: iris_generator
      doc: ''
      parameters:
      - name: context
      outputs: []
      lineno: 17
    xgb_train:
      name: xgb_train
      doc: ''
      parameters:
      - name: context
      - name: dataset
      - name: model_name
        default: model.bst
      - name: max_depth
        default: 6
      - name: num_class
        default: 10
      - name: eta
        default: 0.2
      - name: gamma
        default: 0.1
      - name: steps
        default: 20
      outputs: []
      lineno: 26
    plot_iter:
      name: plot_iter
      doc: ''
      parameters:
      - name: context
      - name: iterations
      - name: col
        default: accuracy
      - name: num_bins
        default: 10
      outputs: []
      lineno: 64
  description: ''
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHdhcm5pbmdzCndhcm5pbmdzLnNpbXBsZWZpbHRlcihhY3Rpb249J2lnbm9yZScsIGNhdGVnb3J5PUZ1dHVyZVdhcm5pbmcpCgppbXBvcnQgeGdib29zdCBhcyB4Z2IKaW1wb3J0IG9zCmZyb20gc2tsZWFybi5kYXRhc2V0cyBpbXBvcnQgbG9hZF9pcmlzCmZyb20gc2tsZWFybi5tb2RlbF9zZWxlY3Rpb24gaW1wb3J0IHRyYWluX3Rlc3Rfc3BsaXQKaW1wb3J0IG51bXB5IGFzIG5wCmZyb20gc2tsZWFybi5tZXRyaWNzIGltcG9ydCBhY2N1cmFjeV9zY29yZQpmcm9tIG1scnVuLmFydGlmYWN0cyBpbXBvcnQgVGFibGVBcnRpZmFjdCwgUGxvdEFydGlmYWN0CmltcG9ydCBwYW5kYXMgYXMgcGQKZnJvbSBjbG91ZHBpY2tsZSBpbXBvcnQgZHVtcHMKCgpkZWYgaXJpc19nZW5lcmF0b3IoY29udGV4dCk6CiAgICBpcmlzID0gbG9hZF9pcmlzKCkKICAgIGlyaXNfZGF0YXNldCA9IHBkLkRhdGFGcmFtZShkYXRhPWlyaXMuZGF0YSwgY29sdW1ucz1pcmlzLmZlYXR1cmVfbmFtZXMpCiAgICBpcmlzX2xhYmVscyA9IHBkLkRhdGFGcmFtZShkYXRhPWlyaXMudGFyZ2V0LCBjb2x1bW5zPVsnbGFiZWwnXSkKICAgIGlyaXNfZGF0YXNldCA9IHBkLmNvbmNhdChbaXJpc19kYXRhc2V0LCBpcmlzX2xhYmVsc10sIGF4aXM9MSkKICAgIGNvbnRleHQubG9nZ2VyLmluZm8oJ3NhdmluZyBpcmlzIGRhdGFmcmFtZSB0byB7fScuZm9ybWF0KGNvbnRleHQub3V0X3BhdGgpKQogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoVGFibGVBcnRpZmFjdCgnaXJpc19kYXRhc2V0JywgZGY9aXJpc19kYXRhc2V0KSkKICAgIAoKZGVmIHhnYl90cmFpbihjb250ZXh0LCAKICAgICAgICAgICAgICBkYXRhc2V0PScnLAogICAgICAgICAgICAgIG1vZGVsX25hbWU9J21vZGVsLmJzdCcsCiAgICAgICAgICAgICAgbWF4X2RlcHRoPTYsCiAgICAgICAgICAgICAgbnVtX2NsYXNzPTEwLAogICAgICAgICAgICAgIGV0YT0wLjIsCiAgICAgICAgICAgICAgZ2FtbWE9MC4xLAogICAgICAgICAgICAgIHN0ZXBzPTIwKToKCiAgICBkZiA9IHBkLnJlYWRfY3N2KGRhdGFzZXQpCiAgICBYID0gZGYuZHJvcChbJ2xhYmVsJ10sIGF4aXM9MSkKICAgIHkgPSBkZlsnbGFiZWwnXQogICAgCiAgICBYX3RyYWluLCBYX3Rlc3QsIFlfdHJhaW4sIFlfdGVzdCA9IHRyYWluX3Rlc3Rfc3BsaXQoWCwgeSwgdGVzdF9zaXplPTAuMikKICAgIGR0cmFpbiA9IHhnYi5ETWF0cml4KFhfdHJhaW4sIGxhYmVsPVlfdHJhaW4pCiAgICBkdGVzdCA9IHhnYi5ETWF0cml4KFhfdGVzdCwgbGFiZWw9WV90ZXN0KQoKICAgIHBhcmFtID0geyJtYXhfZGVwdGgiOiBtYXhfZGVwdGgsCiAgICAgICAgICAgICAiZXRhIjogZXRhLCAibnRocmVhZCI6IDQsCiAgICAgICAgICAgICAibnVtX2NsYXNzIjogbnVtX2NsYXNzLAogICAgICAgICAgICAgImdhbW1hIjogZ2FtbWEsCiAgICAgICAgICAgICAib2JqZWN0aXZlIjogIm11bHRpOnNvZnRwcm9iIn0KCiAgICB4Z2JfbW9kZWwgPSB4Z2IudHJhaW4ocGFyYW0sIGR0cmFpbiwgc3RlcHMpCgogICAgcHJlZHMgPSB4Z2JfbW9kZWwucHJlZGljdChkdGVzdCkKICAgIGJlc3RfcHJlZHMgPSBucC5hc2FycmF5KFtucC5hcmdtYXgobGluZSkgZm9yIGxpbmUgaW4gcHJlZHNdKQoKICAgIGNvbnRleHQubG9nX3Jlc3VsdCgnYWNjdXJhY3knLCBmbG9hdChhY2N1cmFjeV9zY29yZShZX3Rlc3QsIGJlc3RfcHJlZHMpKSkKICAgIAogICAgY29udGV4dC5sb2dfYXJ0aWZhY3QoJ21vZGVsJywgYm9keT1kdW1wcyh4Z2JfbW9kZWwpLCAKICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX3BhdGg9bW9kZWxfbmFtZSwgbGFiZWxzPXsnZnJhbWV3b3JrJzogJ3hnYm9vc3QnfSkKICAgIAogICAgCmltcG9ydCBtYXRwbG90bGliCmltcG9ydCBtYXRwbG90bGliLnB5cGxvdCBhcyBwbHQKZnJvbSBpbyBpbXBvcnQgQnl0ZXNJTwoKZGVmIHBsb3RfaXRlcihjb250ZXh0LCBpdGVyYXRpb25zLCBjb2w9J2FjY3VyYWN5JywgbnVtX2JpbnM9MTApOgogICAgZGYgPSBwZC5yZWFkX2NzdihCeXRlc0lPKGl0ZXJhdGlvbnMuZ2V0KCkpKQogICAgeCA9IGRmWydvdXRwdXQue30nLmZvcm1hdChjb2wpXQogICAgZmlnLCBheCA9IHBsdC5zdWJwbG90cyhmaWdzaXplPSg2LDYpKQogICAgbiwgYmlucywgcGF0Y2hlcyA9IGF4Lmhpc3QoeCwgbnVtX2JpbnMsIGRlbnNpdHk9MSkKICAgIGF4LnNldF94bGFiZWwoJ0FjY3VyYWNjeScpCiAgICBheC5zZXRfeWxhYmVsKCdDb3VudCcpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3QoJ215ZmlnJywgYm9keT1maWcpKQoK
    base_image: mlrun/mlrun
    commands:
    - pip install sklearn
    - pip install xgboost
    - pip install matplotlib
    code_origin: https://github.com/mlrun/demo-xgb-project.git#85272a8e047dae82e9332aa669c4675a9727a425:notebooks/train-xgboost.ipynb
